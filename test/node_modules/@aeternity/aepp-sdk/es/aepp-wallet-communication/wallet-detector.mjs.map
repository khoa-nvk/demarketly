{"version":3,"file":"wallet-detector.mjs","names":["BrowserWindowMessageConnection","MESSAGE_DIRECTION","METHODS","UnsupportedPlatformError","connection","onDetected","window","wallets","connect","origin","source","method","params","readyToConnect","id","wallet","info","getConnection","isExtension","type","sendDirection","to_waellet","undefined","receiveDirection","to_aepp","target","newWallet","Object","keys","length","disconnect"],"sources":["../../src/aepp-wallet-communication/wallet-detector.ts"],"sourcesContent":["/*\n * ISC License (ISC)\n * Copyright (c) 2022 aeternity developers\n *\n *  Permission to use, copy, modify, and/or distribute this software for any\n *  purpose with or without fee is hereby granted, provided that the above\n *  copyright notice and this permission notice appear in all copies.\n *\n *  THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n *  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\n *  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n *  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\n *  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\n *  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\n *  PERFORMANCE OF THIS SOFTWARE.\n */\n\nimport BrowserConnection from './connection/Browser';\nimport BrowserWindowMessageConnection from './connection/BrowserWindowMessage';\nimport { MESSAGE_DIRECTION, METHODS } from './schema';\nimport { UnsupportedPlatformError } from '../utils/errors';\n\ninterface Wallet {\n  info: {\n    id: string;\n    type: string;\n    origin: string;\n  };\n  getConnection: () => BrowserWindowMessageConnection;\n}\ninterface Wallets { [key: string]: Wallet }\n\n/**\n * A function to detect available wallets\n * @category aepp wallet communication\n * @param connection - connection to use to detect wallets\n * @param onDetected - call-back function which trigger on new wallet\n * @returns a function to stop scanning\n */\nexport default (\n  connection: BrowserConnection,\n  onDetected: ({ wallets, newWallet }: { wallets: Wallets; newWallet?: Wallet }) => void,\n): () => void => {\n  if (window == null) throw new UnsupportedPlatformError('Window object not found, you can run wallet detector only in browser');\n  const wallets: Wallets = {};\n\n  connection.connect((\n    { method, params }: { method: string; params: Wallet['info'] },\n    origin: string,\n    source: Window,\n  ) => {\n    if (method !== METHODS.readyToConnect || wallets[params.id] != null) return;\n\n    const wallet = {\n      info: params,\n      getConnection() {\n        const isExtension = params.type === 'extension';\n        return new BrowserWindowMessageConnection({\n          sendDirection: isExtension ? MESSAGE_DIRECTION.to_waellet : undefined,\n          receiveDirection: isExtension ? MESSAGE_DIRECTION.to_aepp : undefined,\n          target: source,\n          origin: isExtension ? window.origin : params.origin,\n        });\n      },\n    };\n    wallets[wallet.info.id] = wallet;\n    onDetected({ wallets, newWallet: wallet });\n  }, () => {});\n  if (Object.keys(wallets).length > 0) onDetected({ wallets });\n\n  return () => connection.disconnect();\n};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;OAGOA,8B;SACEC,iB,EAAmBC,O;SACnBC,wB;;AAYT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe,CACbC,UADa,EAEbC,UAFa,KAGE;EACf,IAAIC,MAAM,IAAI,IAAd,EAAoB,MAAM,IAAIH,wBAAJ,CAA6B,sEAA7B,CAAN;EACpB,MAAMI,OAAgB,GAAG,EAAzB;EAEAH,UAAU,CAACI,OAAX,CAAmB,OAEjBC,MAFiB,EAGjBC,MAHiB,KAId;IAAA,IAHH;MAAEC,MAAF;MAAUC;IAAV,CAGG;IACH,IAAID,MAAM,KAAKT,OAAO,CAACW,cAAnB,IAAqCN,OAAO,CAACK,MAAM,CAACE,EAAR,CAAP,IAAsB,IAA/D,EAAqE;IAErE,MAAMC,MAAM,GAAG;MACbC,IAAI,EAAEJ,MADO;;MAEbK,aAAa,GAAG;QACd,MAAMC,WAAW,GAAGN,MAAM,CAACO,IAAP,KAAgB,WAApC;QACA,OAAO,IAAInB,8BAAJ,CAAmC;UACxCoB,aAAa,EAAEF,WAAW,GAAGjB,iBAAiB,CAACoB,UAArB,GAAkCC,SADpB;UAExCC,gBAAgB,EAAEL,WAAW,GAAGjB,iBAAiB,CAACuB,OAArB,GAA+BF,SAFpB;UAGxCG,MAAM,EAAEf,MAHgC;UAIxCD,MAAM,EAAES,WAAW,GAAGZ,MAAM,CAACG,MAAV,GAAmBG,MAAM,CAACH;QAJL,CAAnC,CAAP;MAMD;;IAVY,CAAf;IAYAF,OAAO,CAACQ,MAAM,CAACC,IAAP,CAAYF,EAAb,CAAP,GAA0BC,MAA1B;IACAV,UAAU,CAAC;MAAEE,OAAF;MAAWmB,SAAS,EAAEX;IAAtB,CAAD,CAAV;EACD,CArBD,EAqBG,MAAM,CAAE,CArBX;EAsBA,IAAIY,MAAM,CAACC,IAAP,CAAYrB,OAAZ,EAAqBsB,MAArB,GAA8B,CAAlC,EAAqCxB,UAAU,CAAC;IAAEE;EAAF,CAAD,CAAV;EAErC,OAAO,MAAMH,UAAU,CAAC0B,UAAX,EAAb;AACD,CAhCD"}