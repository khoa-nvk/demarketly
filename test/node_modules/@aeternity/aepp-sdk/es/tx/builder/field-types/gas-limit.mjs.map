{"version":3,"file":"gas-limit.mjs","names":["IllegalArgumentError","MIN_GAS_PRICE","shortUInt","buildFee","calculateGasLimitMax","txType","gasMax","rebuildTx","dividedBy","serialize","_value","_computingGasLimit","gasLimitMax","gasLimit","value"],"sources":["../../../../src/tx/builder/field-types/gas-limit.ts"],"sourcesContent":["import { IllegalArgumentError } from '../../../utils/errors';\nimport { MIN_GAS_PRICE, Tag } from '../constants';\nimport shortUInt from './short-u-int';\nimport { buildFee } from './fee';\n\nfunction calculateGasLimitMax(\n  txType: Tag,\n  gasMax: number,\n  rebuildTx: (value: number) => any,\n): number {\n  return gasMax - +buildFee(txType, rebuildTx(gasMax)).dividedBy(MIN_GAS_PRICE);\n}\n\nexport default {\n  ...shortUInt,\n\n  serialize(\n    _value: number | undefined,\n    {\n      txType, rebuildTx, gasMax = 6e6, _computingGasLimit,\n    }: {\n      txType: Tag;\n      rebuildTx: (params: any) => any;\n      gasMax: number;\n      _computingGasLimit?: number;\n    },\n  ): Buffer {\n    if (_computingGasLimit != null) return shortUInt.serialize(_computingGasLimit);\n\n    const gasLimitMax = calculateGasLimitMax(\n      txType,\n      gasMax,\n      (gasLimit) => rebuildTx({ _computingGasLimit: gasLimit }),\n    );\n    const value = _value ?? gasLimitMax;\n    if (value > gasLimitMax) {\n      throw new IllegalArgumentError(`Gas limit ${value} must be less or equal to ${gasLimitMax}`);\n    }\n    return shortUInt.serialize(value);\n  },\n};\n"],"mappings":"SAASA,oB;SACAC,a;OACFC,S;SACEC,Q;;AAET,SAASC,oBAAT,CACEC,MADF,EAEEC,MAFF,EAGEC,SAHF,EAIU;EACR,OAAOD,MAAM,GAAG,CAACH,QAAQ,CAACE,MAAD,EAASE,SAAS,CAACD,MAAD,CAAlB,CAAR,CAAoCE,SAApC,CAA8CP,aAA9C,CAAjB;AACD;;AAED,eAAe,EACb,GAAGC,SADU;;EAGbO,SAAS,CACPC,MADO,QAUC;IAAA,IARR;MACEL,MADF;MACUE,SADV;MACqBD,MAAM,GAAG,GAD9B;MACmCK;IADnC,CAQQ;IACR,IAAIA,kBAAkB,IAAI,IAA1B,EAAgC,OAAOT,SAAS,CAACO,SAAV,CAAoBE,kBAApB,CAAP;IAEhC,MAAMC,WAAW,GAAGR,oBAAoB,CACtCC,MADsC,EAEtCC,MAFsC,EAGrCO,QAAD,IAAcN,SAAS,CAAC;MAAEI,kBAAkB,EAAEE;IAAtB,CAAD,CAHe,CAAxC;IAKA,MAAMC,KAAK,GAAGJ,MAAH,aAAGA,MAAH,cAAGA,MAAH,GAAaE,WAAxB;;IACA,IAAIE,KAAK,GAAGF,WAAZ,EAAyB;MACvB,MAAM,IAAIZ,oBAAJ,CAA0B,aAAYc,KAAM,6BAA4BF,WAAY,EAApF,CAAN;IACD;;IACD,OAAOV,SAAS,CAACO,SAAV,CAAoBK,KAApB,CAAP;EACD;;AA1BY,CAAf"}